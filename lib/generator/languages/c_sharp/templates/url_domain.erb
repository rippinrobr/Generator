//------------------------------------------------------------------------------
// Generated on <%= Time.new.inspect %>
// Generated by <%= Etc.getlogin %>
// Using Generator 0.1.1
//------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Net;
using System.Text;
using Newtonsoft.Json;

using <%= @settings.output_settings[:model_namespace] %>;
<% @settings.output_settings[:imports].each do |ns| %>
using <%= ns %>;
<% end %>

<% 
@domain_class_name = @settings.output_settings[:service_class_name]  
@model_class_name = @settings.class_name
@model_class_name = @settings.output_settings[:model_name]
@settings.output_settings[:service_namespace] = @settings.output_settings[:model_namespace] if @settings.output_settings[:service_namespace].nil? || @settings.output_settings[:service_namespace] == ''
%>
namespace <%= @settings.output_settings[:service_namespace] %>
{

   public interface I<%= @domain_class_name %>
   {
   	string ErrorMessage {get;set;}
	IQueryable<<%= @model_class_name.clean_name %>> Get(string inputFilePath);
   } 

   public class <%= @domain_class_name %> 
   {
   	public string ErrorMessage {get;set;}

	public IEnumerable<<%= @settings.class_name.clean_name %>> Get(string inputUri) 
	{
          if (String.IsNullOrEmpty(inputUri)) throw new ArgumentNullException("inputUri");
          var dataList = new List<<%= @settings.class_name.clean_name %>>();

          var rawContent = LoadeSiteContent(inputUri);
	  var parsedContent = JsonConvert.DeserializeObject<<%= @settings.class_name.clean_name %>>(rawContent);
          if (parsedContent != null ) dataList.Add(parsedContent);

	  return dataList;
	}

        private static string LoadeSiteContent(string url)
        {
          var client = new WebClient();
          var html = client.DownloadData(url);
          var utf = new UTF8Encoding();
    
          return utf.GetString(html);
        }
   }
}


